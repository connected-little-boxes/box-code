#pragma once

#include "utils.h"
#include "settings.h"
#include "controller.h"
#include "processes.h"

#define PIXEL_OK 100
#define PIXEL_OFF 101
#define PIXEL_ERROR_NO_PIXELS 102

#include <Adafruit_NeoPixel.h>

#define PIXEL_RING_CONFIG NEO_GRB+NEO_KHZ800
#define PIXEL_STRING_CONFIG NEO_KHZ400+NEO_RGB

#define MAX_NO_OF_VIRTUAL_PIXELS 20

#define MAX_NO_OF_PIXELS 200

#define MILLIS_BETWEEN_UPDATES 20

#define MAX_BRIGHTNESS 255

struct ColourValue {
	float r, g, b;
};
#define BLACK_COLOUR {0,0,0}
#define RED_COLOUR {1,0,0}
#define GREEN_COLOUR {0,1,0}
#define BLUE_COLOUR {0,0,1}
#define YELLOW_COLOUR {1,1,0}
#define ORANGE_COLOUR {1,165.0/255.0,0}
#define MAGENTA_COLOUR {1,0,1}
#define CYAN_COLOUR {0,1,1}
#define WHITE_COLOUR {1,1,1}
#define AQUAMARINE_COLOUR {127.0/255.0,1,212.0/255.0}
#define AZURE_COLOUR {0,138/255.0,216/255.0}
#define BEIGE_COLOUR {245.0/255.0,245.0/255.0,220.0/255.0}
#define BLUE_VIOLET_COLOUR {138.0/255.0,43.0/255.0,226.0/255.0}
#define BROWN_COLOUR {165.0/255.0,42.0/255.0,42.0/255.0}
#define BURLYWOOD_COLOUR {222/255.0,184/255.0,135/255.0}
#define CADET_BLUE_COLOUR {95/255.0,158/255.0,160/255.0}
#define CHARTREUSE_COLOUR {127/255.0,255/255.0,0/255.0}
#define CHOCOLATE_COLOUR {210/255.0,105/255.0,30/255.0}
#define CORAL_COLOUR {255/255.0,127/255.0,80/255.0}
#define CORNFLOWER_BLUE_COLOUR {100/255.0,149/255.0,237/255.0}
#define CORNSILK_COLOUR {255/255.0,248/255.0,220/255.0}
#define DARK_BLUE_COLOUR {0/255.0,0/255.0,139/255.0}
#define DARK_CYAN_COLOUR {0/255.0,139/255.0,139/255.0}
#define DARK_GOLDENROD_COLOUR {184/255.0,134/255.0,11/255.0}
#define DARK_GRAY_COLOUR {169/255.0,169/255.0,169/255.0}
#define DARK_GREEN_COLOUR {0/255.0,100/255.0,0/255.0}
#define DARK_KHAKI_COLOUR {189/255.0,183/255.0,107/255.0}
#define DARK_MAGENTA_COLOUR {139/255.0,0/255.0,139/255.0}
#define DARKOLIVE_GREEN_COLOUR {85/255.0,107/255.0,47/255.0}
#define DARK_ORANGE_COLOUR {255/255.0,140/255.0,0/255.0}
#define DARK_ORCHID_COLOUR {153/255.0,50/255.0,204/255.0}
#define DARK_RED_COLOUR {139/255.0,0/255.0,0/255.0}
#define DARK_SALMON_COLOUR {233/255.0,150/255.0,122/255.0}
#define DARK_SEA_GREEN_COLOUR {143/255.0,188/255.0,143/255.0}
#define DARK_SLATE_BLUE_COLOUR {72/255.0,61/255.0,139/255.0}
#define DARK_SLATE_GRAY_COLOUR {47/255.0,79/255.0,79/255.0}
#define DARK_TURQUOISE_COLOUR {0/255.0,206/255.0,209/255.0}
#define DARK_VIOLET_COLOUR {148/255.0,0/255.0,211/255.0}
#define DEEP_PINK_COLOUR {255/255.0,20/255.0,147/255.0}
#define DEEP_SKY_BLUE_COLOUR {0/255.0,191/255.0,255/255.0}
#define DIM_GRAY_COLOUR {105/255.0,105/255.0,105/255.0}
#define DODGERBLUE_COLOUR {30/255.0,144/255.0,255/255.0}
#define FIREBRICK_COLOUR {178/255.0,34/255.0,34/255.0}
#define FLORAL_WHITE_COLOUR {255/255.0,250/255.0,240/255.0}
#define FOREST_GREEN_COLOUR {34/255.0,139/255.0,34/255.0}
#define GAINSBORO_COLOUR {220/255.0,220/255.0,220/255.0}
#define GHOST_WHITE_COLOUR {255/255.0,250/255.0,250/255.0}
#define GOLD_COLOUR {255/255.0,215/255.0,0/255.0}
#define GOLDENROD_COLOUR {218/255.0,165/255.0,32/255.0}
#define GRAY_COLOUR {128/255.0,128/255.0,128/255.0}
#define HONEYDEW_COLOUR {240/255.0,255/255.0,240/255.0}
#define HOT_PINK_COLOUR {255/255.0,105/255.0,180/255.0}
#define INDIAN_RED_COLOUR {205/255.0,92/255.0,92/255.0}
#define IVORY_COLOUR {255/255.0,255/255.0,240/255.0}
#define KHAKI_COLOUR {240/255.0,230/255.0,140/255.0}
#define LAVENDER_COLOUR {230/255.0,230/255.0,250/255.0}
#define LAVENDER_BLUSH_COLOUR {255/255.0,240/255.0,245/255.0}
#define LAWN_GREEN_COLOUR {124/255.0,252/255.0,0/255.0}
#define LEMON_COLOUR {239/255.0,253/255.0,95/255.0}
#define LIGHT_BLUE_COLOUR {173/255.0,216/255.0,230/255.0}
#define LIGHT_CORAL_COLOUR {240/255.0,128/255.0,128/255.0}
#define LIGHT_CYAN_COLOUR {224/255.0,255/255.0,255/255.0}
#define LIGHT_GOLDENROD_COLOUR {238/255.0,221/255.0,130/255.0}
#define LIGHT_GOLDENROD YELLOW_COLOUR {250/255.0,250/255.0,210/255.0}
#define LIGHT_GRAY_COLOUR {211/255.0,211/255.0,211/255.0}
#define LIGHT_GREEN_COLOUR {144/255.0,238/255.0,144/255.0}
#define LIGHT_PINK_COLOUR {255/255.0,182/255.0,193/255.0}
#define LIGHT_SALMON_COLOUR {255/255.0,160/255.0,122/255.0}
#define LIGHT_SEA_GREEN_COLOUR {32/255.0,178/255.0,170/255.0}
#define LIGHT_SKY_BLUE_COLOUR {135/255.0,206/255.0,250/255.0}
#define LIGHT_SLATE_BLUE_COLOUR {132/255.0,112/255.0,255/255.0}
#define LIGHT_SLATE_GRAY_COLOUR {119/255.0,136/255.0,153/255.0}
#define LIGHT_STEEL_BLUE_COLOUR {176/255.0,196/255.0,222/255.0}
#define LIGHT_YELLOW_COLOUR {255/255.0,255/255.0,224/255.0}
#define LIME_GREEN_COLOUR {50/255.0,205/255.0,50/255.0}
#define LINEN_COLOUR {250/255.0,240/255.0,230/255.0}
#define MAROON_COLOUR {128/255.0,0/255.0,0/255.0}
#define MEDIUM_AQUAMARINE_COLOUR {102/255.0,205/255.0,170/255.0}
#define MEDIUM_BLUE_COLOUR {0/255.0,0/255.0,205/255.0}
#define MEDIUM_ORCHID_COLOUR {186/255.0,85/255.0,211/255.0}
#define MEDIUM_PURPLE_COLOUR {147/255.0,112/255.0,219/255.0}
#define MEDIUM_SEA_GREEN_COLOUR {60/255.0,179/255.0,113/255.0}
#define MEDIUM_SLATE_BLUE_COLOUR {123/255.0,104/255.0,238/255.0}
#define MEDIUM_SPRING_GREEN_COLOUR {0/255.0,250/255.0,154/255.0}
#define MEDIUM_TURQUOISE_COLOUR {72/255.0,209/255.0,204/255.0}
#define MEDIUM_VIOLET_COLOUR {199/255.0,21/255.0,133/255.0}
#define MIDNIGHT_BLUE_COLOUR {25/255.0,25/255.0,112/255.0}
#define MINT_CREAM_COLOUR {245/255.0,255/255.0,250/255.0}
#define MISTY_ROSE_COLOUR {255/255.0,228/255.0,225/255.0}
#define MOCCASIN_COLOUR {255/255.0,228/255.0,181/255.0}
#define NAVAJO_WHITE_COLOUR {255/255.0,222/255.0,173/255.0}
#define NAVY_COLOUR {0/255.0,0/255.0,128/255.0}
#define OLD_LACE_COLOUR {253/255.0,245/255.0,230/255.0}
#define OLIVE_COLOUR {128/255.0,128/255.0,0/255.0}
#define OLIVE_DRAB_COLOUR {107/255.0,142/255.0,35/255.0}
#define ORCHID_COLOUR {218/255.0,112/255.0,214/255.0}
#define PALE_GOLDENROD_COLOUR {238/255.0,232/255.0,170/255.0}
#define PALE_GREEN_COLOUR {152/255.0,251/255.0,152/255.0}
#define PALE_TURQUOISE_COLOUR {175/255.0,238/255.0,238/255.0}
#define PALE_VIOLET_COLOUR {219/255.0,112/255.0,147/255.0}
#define PAPAYA_WHIP_COLOUR {255/255.0,239/255.0,213/255.0}
#define PEACH_PUFF_COLOUR {255/255.0,218/255.0,185/255.0}
#define PERU_COLOUR {205/255.0,133/255.0,63/255.0}
#define PINK_COLOUR {255/255.0,192/255.0,203/255.0}
#define PLUM_COLOUR {221/255.0,160/255.0,221/255.0}
#define POWDER_BLUE_COLOUR {176/255.0,224/255.0,230/255.0}
#define PURPLE_COLOUR {128/255.0,0/255.0,128/255.0}
#define ROSY_BROWN_COLOUR {188/255.0,143/255.0,143/255.0}
#define ROYAL_BLUE_COLOUR {65/255.0,105/255.0,225/255.0}
#define SADDLE_BROWN_COLOUR {139/255.0,69/255.0,19/255.0}
#define SALMON_COLOUR {250/255.0,128/255.0,114/255.0}
#define SANDY_BROWN_COLOUR {244/255.0,164/255.0,96/255.0}
#define SEA_GREEN_COLOUR {46/255.0,139/255.0,87/255.0}
#define SEASHELL_COLOUR {255/255.0,245/255.0,238/255.0}
#define SIENNA_COLOUR {160/255.0,82/255.0,45/255.0}
#define SILVER_COLOUR {192/255.0,192/255.0,192/255.0}
#define SKY_BLUE_COLOUR {135/255.0,206/255.0,235/255.0}
#define SLATE_BLUE_COLOUR {106/255.0,90/255.0,205/255.0}
#define SLATE_GRAY_COLOUR {112/255.0,128/255.0,144/255.0}
#define SNOW_COLOUR {255/255.0,250/255.0,250/255.0}
#define SPRING_GREEN_COLOUR {0/255.0,255/255.0,127/255.0}
#define STEEL_BLUE_COLOUR {70/255.0,130/255.0,180/255.0}
#define TAN_COLOUR {210/255.0,180/255.0,140/255.0}
#define TEAL_COLOUR {0/255.0,128/255.0,128/255.0}
#define THISTLE_COLOUR {216/255.0,191/255.0,216/255.0}
#define TOMATO_COLOUR {255/255.0,99/255.0,71/255.0}
#define TURQUOISE_COLOUR {64/255.0,224/255.0,208/255.0}
#define VIOLET_COLOUR {143/255.0,0/255.0,255/255.0}
#define WHEAT_COLOUR {245/255.0,222/255.0,179/255.0}
#define WHITE_SMOKE_COLOUR {245/255.0,245/255.0,245/255.0}

struct colourLookup{
	const char * name;
	ColourValue col;
};

#define PIXEL_COMMAND_NAME_LENGTH 20
#define PIXEL_COLOUR_NAME_LENGTH 15

boolean coloursEqual(ColourValue a, ColourValue b);

void beginStatusDisplay();
void beginWifiStatusDisplay();
boolean addStatusItem(boolean status);
void renderStatusDisplay();
void setupWalkingColour(ColourValue colour);
void changeWalkingColour(ColourValue colour);

void pixelStatusMessage(struct process * pixelProcess, char * buffer, int bufferLength);
boolean addStatusItem(boolean status);

struct PixelSettings
{
	int pixelControlPinNo;
	int noOfPixels;
	int noOfVirtualPixels;
	int pixelConfig;
};

extern struct PixelSettings pixelSettings;
extern struct colourLookup colourNames[];
extern int noOfColours;

extern struct SettingItemCollection pixelSettingItems;

extern struct process pixelProcess;

boolean validateColour(void* dest, const char* newValueStr);

void fadeWalkingColour(ColourValue newColour, int noOfSteps);
struct colourLookup * findColourByName(const char * name);